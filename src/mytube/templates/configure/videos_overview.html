{% extends "configure/base.html" %}

{% block content %}
<section>
  <h2>Stored Videos</h2>
  <form class="videos-filter-form" method="get">
    <div class="videos-filter-sections">
      {% for section_key, section_label, selected in (
        ("include", "Include", video_filters.include),
        ("exclude", "Exclude", video_filters.exclude),
      ) %}
      <fieldset class="videos-filter-section">
        <legend>{{ section_label }}</legend>
        <div class="videos-filter-checkboxes">
          {% for key, label in video_filter_options %}
          <label class="videos-filter-checkbox">
            <input type="checkbox" name="{{ section_key }}" value="{{ key }}"{% if key in selected %} checked{% endif %}>
            {{ label }}
          </label>
          {% endfor %}
        </div>
        <details class="videos-filter-channels"{% if section_key == 'include' and video_filters.include_channels %} open{% elif section_key == 'exclude' and video_filters.exclude_channels %} open{% endif %}>
          <summary>Channels</summary>
          <div class="videos-filter-checkboxes videos-filter-channel-grid">
            {% for channel in filter_channels %}
            <label class="videos-filter-checkbox">
              <input type="checkbox" name="{{ section_key }}_channel" value="{{ channel.id }}"{% if (section_key == 'include' and channel.id in video_filters.include_channels) or (section_key == 'exclude' and channel.id in video_filters.exclude_channels) %} checked{% endif %}>
              {{ channel.title }}
            </label>
            {% endfor %}
          </div>
        </details>
      </fieldset>
      {% endfor %}
    </div>
    <div class="videos-filter-actions">
      <button type="submit" class="videos-filter-button">Filter</button>
    </div>
  </form>
  {% if videos %}
  <div class="videos-table-wrapper">
    <table class="videos-table">
      <colgroup>
        <col class="videos-table-play-column" />
        <col class="videos-table-channel-column" />
        <col class="videos-table-title-column" />
        <col class="videos-table-actions-column" />
      </colgroup>
      <thead>
        <tr>
          <th scope="col" class="videos-table-play">Play</th>
          <th scope="col">Channel</th>
          <th scope="col">Video</th>
          <th scope="col" class="videos-table-actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for video in videos %}
        <tr>
          <td class="videos-table-play">
            <a class="videos-table-icon" href="{{ video.play_url }}" title="Play on home page">â–¶</a>
          </td>
          <td class="videos-table-channel">{{ video.channel_title }}</td>
          <td class="videos-table-title">
            <a href="{{ video.url }}">{{ video.video_title }}</a>
            {% if video.vote %}
            <span class="videos-table-vote">
              <span class="thumb-icon">
                <span class="thumb-emoji {% if video.vote == 'ðŸ‘' %}thumb-up{% else %}thumb-down{% endif %}">{{ video.vote }}</span>
              </span>{% if video.flagged_disqualifier %}<span class="videos-table-flag" title="Flagged"> âš‘</span>{% endif %}
            </span>
            {% endif %}
          </td>
          <td class="videos-table-actions">
            {% if video.raw_url %}
            <a class="videos-table-icon" href="{{ video.raw_url }}" title="View raw data">âœ…</a>
            {% else %}
            <form method="post" action="{{ video.load_url }}" class="videos-table-load-form">
              <button type="submit" title="Load video data">â¤“</button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p>No videos have been stored yet.</p>
  {% endif %}
</section>
{% endblock %}
